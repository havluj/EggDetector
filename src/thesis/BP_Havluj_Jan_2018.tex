% options:
% thesis=B bachelor's thesis
% thesis=M master's thesis
% czech thesis in Czech language
% slovak thesis in Slovak language
% english thesis in English language
% hidelinks remove colour boxes around hyperlinks

\documentclass[thesis=B,czech,hidelinks]{template/FITthesis}[2012/06/26]

\usepackage[cp1250]{inputenc} % LaTeX source encoded as Windows-1250

\usepackage{graphicx} %graphics files inclusion
% \usepackage{amsmath} %advanced maths
% \usepackage{amssymb} %additional math symbols

\usepackage{subfig}
\usepackage{dirtree} %directory tree visualisation
\usepackage[czech]{babel}
\usepackage[T1]{fontenc}
\usepackage{float}
\usepackage{empheq}

\usepackage{textcomp}

\include{chapters/documentation/out_preamble}
\renewcommand{\bf}{\textbf}

\usepackage{listings}
\usepackage{color}
\usepackage{enumitem}
\definecolor{dkgreen}{rgb}{0,0.6,0}
\definecolor{gray}{rgb}{0.5,0.5,0.5}
\definecolor{mauve}{rgb}{0.58,0,0.82}
\definecolor{maroon}{rgb}{0.5,0,0}
\definecolor{darkgreen}{rgb}{0,0.5,0}
\colorlet{punct}{red!60!black}
\definecolor{delim}{RGB}{20,105,176}
\colorlet{numb}{magenta!60!black}
\lstset{frame=shadowbox,
	rulesepcolor=\color{gray},
	language=Java,
	aboveskip=3mm,
	belowskip=3mm,
	showstringspaces=false,
	columns=flexible,
	basicstyle={\small\ttfamily},
	numbers=left,
	numberstyle=\tiny\color{gray},
	keywordstyle=\color{blue},
	commentstyle=\color{dkgreen},
	stringstyle=\color{mauve},
	breaklines=true,
	breakatwhitespace=true,
	tabsize=3
}
\lstdefinelanguage{XML}
{
	morestring=[s]{"}{"},
	morecomment=[s]{?}{?},
	morecomment=[s]{!--}{--},
	commentstyle=\color{darkgreen},
	moredelim=[s][\color{black}]{>}{<},
	moredelim=[s][\color{red}]{\ }{=},
	stringstyle=\color{blue},
	identifierstyle=\color{maroon}
}
\lstdefinelanguage{bash}
{
	numbers=none,
	prebreak={\space\textbackslash},
	showstringspaces=false,
	commentstyle=\color{red},
	keywordstyle=\color{blue}
}
\lstdefinelanguage{json}{
	stepnumber=1,
	numbersep=8pt,
	showstringspaces=false,
	breaklines=true,
	literate=
	*{0}{{{\color{numb}0}}}{1}
	{1}{{{\color{numb}1}}}{1}
	{2}{{{\color{numb}2}}}{1}
	{3}{{{\color{numb}3}}}{1}
	{4}{{{\color{numb}4}}}{1}
	{5}{{{\color{numb}5}}}{1}
	{6}{{{\color{numb}6}}}{1}
	{7}{{{\color{numb}7}}}{1}
	{8}{{{\color{numb}8}}}{1}
	{9}{{{\color{numb}9}}}{1}
	{:}{{{\color{punct}{:}}}}{1}
	{,}{{{\color{punct}{,}}}}{1}
	{\{}{{{\color{delim}{\{}}}}{1}
	{\}}{{{\color{delim}{\}}}}}{1}
	{[}{{{\color{delim}{[}}}}{1}
	{]}{{{\color{delim}{]}}}}{1},
}

% % list of acronyms
% \usepackage[acronym,nonumberlist,toc,numberedsection=autolabel]{glossaries}
% \iflanguage{czech}{\renewcommand*{\acronymname}{Seznam pou{\v z}it{\' y}ch zkratek}}{}
% \makeglossaries

\newcommand{\tg}{\mathop{\mathrm{tg}}} %cesky tangens
\newcommand{\cotg}{\mathop{\mathrm{cotg}}} %cesky cotangens

\department{Katedra softwarového inženýrství}
\title{Detekce objektù v ptaèích hnízdech pomocí neuronových sítí}
\authorGN{Jan} %(køestní) jméno (jména) autora
\authorFN{Havlùj} %pøíjmení autora
\authorWithDegrees{Jan Havlùj} %jméno autora vèetnì souèasných akademických titulù
\author{Jan Havlùj} %jméno autora bez akademických titulù
\supervisor{Ing. Josef Pavlíèek, Ph.D.}
\acknowledgements{Chtìl bych podìkovat vedoucímu mé bakaláøské práce, panu Ing. Josefovi Pavlíèkovi Ph.D. za jeho èas, ochotu a pomoc pøi vedení této práce. Dìkuji svým rodièùm a pøítelkyni, kteøí mi byli po celou dobu studia velkou oporou. V~neposlední øadì bych chtìl podìkovat svým spolužákùm, kteøí mì pøi studiu nikdy neváhali podpoøit.}
\placeForDeclarationOfAuthenticity{V~Praze}
\declarationOfAuthenticityOption{4} %volba Prohlášení (èíslo 1-6)
\website{https://github.com/havluj/EggDetector} %volitelná URL práce, objeví se v tiráži - úplnì odstraòte, nemáte-li URL práce

\abstractCS{
	Tato práce se zabývá návrhem a tvorbou softwarové knihovny pro detekci objektù v obraze použitím neuronových sítí. 
	
	V první èásti jsme seznámeni s cílem práce a detailní specifikací požadavkù. Druhá èást se vìnuje teorii poèítaèového vidìní, neuronových sítí a TensorFlow. Následnì je na základì získaných teoretických znalostí a specifikace požadavkù vypracována analýza možného øešení. Dle analýzy jsou navržena a implementována dvì øešení. První implementace se zamìøuje na detekci objektù, druhá na rozpoznávání a klasifikaci obrazu. V poslední èásti je vybráno efektivnìjší øešení, které je øádnì ovìøeno a otestováno.
	
	Výsledkem je softwarová knihovna, která umožòuje automaticky rozpoznávat poèet vajec v daném videu. Celý program je implementován v jazyce Java a je možné ho integrovat do projektu BirdObserver.}
\keywordsCS{neuronové sítì, poèítaèové vidìní, detekce objektù, strojové uèení, uèení s uèitelem, rozpoznávání obrazu, detekce vajec, ptaèí hnízda, Java, TensorFlow}

\abstractEN{
	This thesis focuses on designing and creating a software library that is able to detect objects in images using neural networks.
	
	In the first part of the thesis, goals and technical requirements are specified. The second part discusses the theory behind computer vision, neural networks, and TensorFlow. Using the technical specification and acquired theoretical knowledge, a detailed analysis of a possible solution is presented. There are two implementations of the analysis. The first implementation is developed using object detection, the second one using image recognition. In the last part of the thesis, a more effective implementation is chosen, which is then properly tested and verified.
	
	The result of this thesis is a software library that is able to automatically detect the number of eggs in a given video sequence. The entire solution is written in Java and is easily intergratable with other parts of the BirdObserver project.
}
\keywordsEN{neural networks, computer vision, object detection, machine learning, supervised learning, image recognition, egg detection, bird nests, Java, TensorFlow}

\begin{document}

% \newacronym{CVUT}{{\v C}VUT}{{\v C}esk{\' e} vysok{\' e} u{\v c}en{\' i} technick{\' e} v Praze}
% \newacronym{FIT}{FIT}{Fakulta informa{\v c}n{\' i}ch technologi{\' i}}

\begin{introduction}
	Projekt Ptáci Online byl spuštìn Fakultou životního prostøedí Èeské zemìdìlské univerzity v Praze roku 2014. Hlavním cílem projektu je poskytnout vìdecká data, ve formì videa z ptaèích budek, široké veøejnosti~\cite{oProjektu}. Projekt se tìší pomìrnì velké popularitì~\cite{ptaciVMediich} a aktuálnì spolupracuje s více než dvìma desítkami spolupracovníkù. Mezi nì patøí lidé z akademické sféry, soukromého sektoru, ale i z Ministerstva životního prostøedí Èeské republiky~\cite{oProjektu}. Vzhledem k množství poøízovaných záznamù by bylo žádoucí získávání informací z videa automatizovat pomocí algoritmù umìlé inteligence. Pøedmìtem této práce je vytvoøit algoritmus, který je schopný urèit poèet vajec v hnízdì v daném videozáznamu.\newline\indent
	Existuje hned nìkolik zpùsobù, jak nauèit poèítaè \uv{vidìt}. Témìø vždy se musíme zamìøit na pøedzpracování obrazu, jeho vlastnosti a jeho segmentaci. Jako øešení pak mùžeme zvolit rùznou sadu deterministických algoritmù, napøíklad pro detekci hran nebo na samotné klasifikování segmentovaného obrazu. Všechny tyto algoritmy mají však jednu spoleènou nevýhodu. Formálnì popsat tvar nìjakého objektu a vytvoøit sadu pravidel, podle kterých poznáme, zda-li se jedná o hledaný objekt, je velmi tìžké.	Svìtelné podmínky nemusí být ideální, objekty se mohou pøekrývat, mohou být rùznì barevné, vzdálené nebo otoèené. Všechny tyto problémy znemožòují vytvoøení perfektního algoritmu manuálnì.
	Lepším øešením je použití algoritmù umìlé inteligence, jako jsou napøíklad umìlé neuronové sítì. Mùžeme manuálnì vytvoøit algoritmus, který dokáže \uv{vytrénovat} druhý, obecný, algoritmus k vyøešení konkrétního problému. V této práci se budeme soustøedit na použití neuronových sítí pro vyøešení problémù poèítaèového vidìní.

	
	\section{Struktura práce}
	Práce je rozdìlena do 4 èástí. První èást obsahuje stanovení cílù a specifikaci funkèních i nefunkèních požadavkù. V další èásti diskutujeme teorii poèítaèového vidìní, neuronových sítí a knihovny TensorFlow. Tøetí, analytická èást, se zamìøuje na výbìr vhodných technologií a postupù pro tvorbu implementace. Ètvrtá, praktická èást, je rozdìlena do nìkolika kapitol. Nejprve popisuje použití a vývoj všech potøebných nástrojù. V dalších kapitolách jsou popsány dva rùzné zpùsoby implementace, jejich porovnání, otestování a validace. Na závìr je vybrána efektivnìjší implementace, dle které je vytvoøena softwarová knihovna pro urèení poètu vajec v hnízdì.
\end{introduction}

\include{chapters/1-cil}
\include{chapters/2-reserse}
\include{chapters/3-analyza}
\include{chapters/impl_nastroje}
\include{chapters/4-impl_detekce}
\include{chapters/5-impl_klasifikace}
\include{chapters/6-volba}
\include{chapters/7-overeni}

\begin{conclusion}
	Cílem této práce byl návhr a implementace softwarové knihovny pro urèení poètu vajec v ptaèích hnízdech. Byla sepsána detailní specifikace funkèních a nefunkèních požadavkù, které popisují požadovanou formu knihovny. Prerekvizitou pro implementaci samotné knihovny bylo vyøešení úlohy \uv{rozpoznávání vajec v obraze}.
	
	Ètenáøi byla prezentována veškerá potøebná teorie o strojovém uèení, neuronových sítích a nástroji TensorFlow. Na základì získaných teoretických znalostí byla provedena analýza funkèních a nefunkèních požadavkù; projektu Ptáci Online; souèasného stavu øešení a struktury vstupních dat. Následnì byly navrženy dva smìry implementace, kterým bychom mohli úlohu rozpoznávání vajec vyøešit. V poslední èásti analýzy byly zvoleny vhodné principy a technologie a bylo navrženo uživatelské rozhraní knihovny.
	
	V další kapitole byl ètenáø seznámen se všemi nástroji, které jsou potøebné k dokonèení implementace. Navrhl a naimplementoval jsem dva plnohodnotné nástroje pro práci s daty a nespoèet drobných skriptù pro jejich zpracování. Pomocí tìchto nástrojù jsem manuálnì pøipravil \textbf{8068} trénovacích dat -- oznaèení vajec na snímcích -- které byly následnì použity k trénování neuronových sítí.
	
	Prvním øešením pro detekci vajec byla implementace realizována technikou \uv{detekce objektù v obraze}. Tato implementace pøinesla velmi dobré výsledky a proto jsem se ji rozhodl použít jako základ pro výslednou knihovnu. Druhý styl implementace nebyl tak efektivní a proto jsem se ho rozhodl nepoužít. Nicménì i tento styl implementace je zajímavý a mùže sloužit jako užiteèný základ pro ètenáøe, který se bude zabývat rozpoznáváním obrazu.
	
	Nakonec byla implementována samotná knihovna v programovacím jazyce Java, která je schopna automaticky rozpoznat poèet vajec v hnízdì. Knihovnu jsem øádnì otestoval a zmìøil její efektivitu.
	
	Do budoucna by bylo vhodné systém rozšíøit o zpracovaní obrazu pøed samotnou detekcí vajec. Napøíklad normalizace jasu, kontrastu a expozice by pomohla výsledky znaènì zlepšit. Je zde také prostror pro pøípravu více trénovacích dat a vylepšení konfigurace neuronové sítì.
	
	Cíl této práce byl v plné míøe naplnìn, vèetnì všech funkèních a nefunkèních požadavkù. Nejvìtším pøínosem práce je systém pro detekci objektù v obraze. Vzhledem k návrhu systému staèí, aby byl pøipraven dostateènì velký vzorek trénovacích dat pro jakýkoliv objekt a mùžeme použít tentýž systém napøíklad pro detekci mláïat v hnízdech. Tato práce také slouží jako vhodný základ pro ètenáøe, kterého zajímá øešení problémù poèítaèového vidìní pomocí neuronových sítí a nástroje TensorFlow.
\end{conclusion}

\bibliographystyle{csn690}
\bibliography{mybibliographyfile}

\appendix

\chapter{Seznam použitých zkratek}
% \printglossaries
\begin{description}
	\item[GUI] Graphical user interface
	\item[XML] Extensible markup language
	\item[HTML] HyperText Markup Language
	\item[RAM] Random-access memory
	\item[PDF] Portable Document Format
	\item[NN] Neural Network
	\item[CNN] Convolutional Neural Network
	\item[RCNN] Recursive Convolutional Neural Network
	\item[API] Application Programming Interface
	\item[PNG] Portable Network Graphics
	\item[JPEG] Joint Photographic Experts Group
	
\end{description}

\include{chapters/documentation/out}
\include{chapters/tagger/source}
\include{chapters/trimmer/source}

\chapter{Konfigurace detekování objektù}\label{chap:config_detection}
Výsledný konfiguraèní soubor použitý spoleènì s modelem \newline\texttt{ssd\_mobilenet\_v1\_coco}:
\lstinputlisting[language=json,caption={Konfiguraèní soubor pro detekci vajec v ptaèích hnízdech.}]{media/pipeline.config}

\chapter{Test efektivity knihovny}\label{chap:test_efektivity}
\lstinputlisting[caption={Test k vyhodnocení efektivy výsledné knihovny.}]{media/SuccessRateTest.java}


\chapter{Použité programy}
% \printglossaries
\begin{description}
	\item[TexStudio] psaní bakaláøské práce v \LaTeX a pøeklad do PDF
	\item[Notepad++] úprava textových souborù
	\item[gedit] úprava textových souborù
	\item[IntelliJ IDEA Ultimate] psaní implementace v jazyce Java
	\item[GIT] verzování kódu
	\item[JDK8] kompilace, ladìní a testování Java knihovny
	\item[Python 3] zpracování dat, trénování neuronových sítí
	\item[Tensorflow] softwarová knihovna pro strojové uèení
	\item[LabelImg] oznaèování trénovacích dat
	\item[javadoc] generování dokumentace do HTML
	\item[TexDoclet] generování dokumentace do \LaTeX
	\item[wget] hromadné stahování dat
	\item[bash] pomocné skripty pro zautomatizování práce
	\item[awk] hromadná oprava drobných chyb v datech
\end{description}

\chapter{Obsah pøiloženého média}\label{chap:cd}
\begin{figure}
	\dirtree{%
		.1 bin\DTcomment{adresáø se spustitelnou formou implementace}.
		.1 doc\DTcomment{adresáø s dokumentací implementace}.
		.1 text\DTcomment{text práce}.
		.2 thesis.pdf\DTcomment{text práce ve formátu PDF}.
		.1 src.
		.2 impl\DTcomment{zdrojové kódy implementace}.
		.3 eggdetector\DTcomment{zdrojové kódy implementace knihovny}.
		.3 \texttt{egg\_recognition}\DTcomment{implementace rozpoznávání obrazu}.
		.3 \texttt{object-detection-training}\DTcomment{implementace detekce objektù}.
		.3 tools\DTcomment{zdrojové kódy pomocných nástrojù}.
		.4 \texttt{foldertrimmer}\DTcomment{zdrojové kódy nástroje FolderTrimmer}.
		.4 \texttt{tagger}\DTcomment{zdrojové kódy nástroje Tagger}.
		.4 \texttt{download.sh}\DTcomment{skript pro hromadné stažení dat}.
		.3 \texttt{libtest}\DTcomment{projekt pro testování distribuce knihovny}.
		.2 thesis\DTcomment{zdrojové kód textu práce}.
		.1 readme.txt\DTcomment{struèný popis obsahu média}.
	}
\end{figure}

\end{document}