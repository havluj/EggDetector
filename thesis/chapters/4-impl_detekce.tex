\chapter{Implementace detekování objektù}\label{chap:impl_detekce}
V této kapitole se zamìøíme na implementaci neuronové sítì, která bude sloužit k detekci objektù. V rámci této práce nás bude zajímat pouze jeden objekt: vejce. 

Abychom mohli vytrénovat nový model, který je schopný detekce vajec, je potøeba, abychom snímky a data pøevedli do speciálního formátu. Pro použítí a validaci modelu budeme používat skript, u kterého bude vstupem obrázek libovolné velikosti. Internì bude zmenšen na velikost 300~x~300 bodù. Snímek bude reprezentován pole hodnot o velikosti 300~x~300~x~3 (snímek velikosti 300~x~300 bodù a zùstane barevný -- každý bod obsahuje 3 barevné složky. Jakmile provedeme detekci objektù, musíme objekty klasifikovat do pøedem stanovených kategorií. Kategorie, do které budeme chtít snímky rozøadit, bude pouze \textbf{1}:
\begin{description}[labelindent=1cm]
	\item[Kategorie \uv{egg}:] Objekt vejce.
\end{description}

Celé øešení -- pøíprava dat, trénování neuronové sítì, testování funkènosti a mìøení pøesnosti budeme implementovat v programovacím jazyce Python~3.

\section{Pøíprava vývojového prostøedí}
Abychom mohli používat \texttt{TensorFlow Object Detection API}, je potøeba následnì pøipravit vývojové prostøedí:
\begin{enumerate}
	\item Nainstalovat \texttt{Python~3} a \texttt{pip3}.
	\item Stáhnout repositoø s TensorFlow modely: \texttt{git clone https://github.com/tensorflow/models}.
	\item Nainstalovat modely: \texttt{cd models/research \&\& python3 setup.py}.
	\item Pøidat tyto øádky do \texttt{\textasciitilde/.bashrc} (path\_to\_models\_directory nahradíme skuteèným umístìním modelù):
	\begin{lstlisting}[language=bash]
	export MODELS=path_to_models_directory
	export PYTHONPATH=$MODELS:$MODELS/slim
	export OBJ_DET=$MODELS/object_detection
	\end{lstlisting}
	\item Nainstalovat TensorFlow: \texttt{sudo pip3 install tensorflow-gpu} nebo \texttt{sudo pip3 install tensorflow}. Více informací viz \cite{tensor_install}.
	\item Pro ovìøení instalace spustíme interaktivní \texttt{Python 3}:
	\begin{lstlisting}[language=Python]
	import tensorflow as tf
	hello = tf.constant('EggDetector!')
	sess = tf.Session()
	print(sess.run(hello))
	\end{lstlisting}
	Systém by mìl odpovìdìt \uv{\texttt{EggDetector!}}.
\end{enumerate}

\section{Pøíprava dat}
Nástrojem LabelImg (viz kapitola \ref{subsec:labelimg}) jsem oznaèil \textbf{1800} vajec. Data je potøeba rozdìlit na trénovací a testovací. Testovací data slouží k validaci a vyhodnocení úspìšnosti trénovaného modelu. Standardnì se data dìlí pøibližnì v pomìru 9:1 ve prospìch trénovacích dat. Data jsem rozdìlil následnovnì:
\begin{itemize}
	\item \textbf{1701} výskytù vajec jako trénovací data,
	\item \textbf{189} výskytù vajec jako data validaèní.
\end{itemize}

\section{Struktura projektu}
Projekt, ve kterém budeme celou implementaci tvoøit, bude mít následující strukturu:
\begin{figure}[H]
	\dirtree{%
		.1 object-detection-training\DTcomment{pracovní složka}.
		.2 training\DTcomment{složka s konfigurací}.
		.3 checkpoint\_model\DTcomment{data modelu, ze kterého budeme vycházet}.
		.3 egg\_label\_map.pbtxt.
		.3 pipeline.config.
		.2 test\_images\DTcomment{testovací obrázky k validaci}.
		.2 frozen\_graph\DTcomment{výsledný, exportovaný graf}.
		.2 images\DTcomment{všechna testovací a trénovací data}.
		.3 test\DTcomment{testovací data}.
		.3 train\DTcomment{trénovací data}.
		.2 export\_inference\_graph.py.
		.2 generate\_tfrecord.py.
		.2 xml\_to\_csv.py.
	}
\end{figure}

Stejná struktura je dostupná u pøiloženého zdrojového kódu v pøíloze \ref{chap:cd}, konkrétnì ve složce \texttt{src/object-detection-training}.

Všechny skripty, které používáme k trénování a validaci jsou dostupné v pøíloze \ref{chap:cd}.

\section{Trénování neuronové sítì}
\subsection{Základní model}

\subsection{Konfigurace}

\subsection{Trénovací data}
%
%generate csv files from xml
%`python3.5 xml_to_csv.py`
%
%generate train data
%`python3.5 generate_tfrecord.py --csv_input=data/train_labels.csv --output_path=data/train.record`
%
%generate test data
%`python3.5 generate_tfrecord.py --csv_input=data/test_labels.csv --output_path=data/test.record`
%


\subsection{Trénování}
checkpointy, ukázky tensorboard, atd
sledovani trenovani
muzeme trenovat lokalne nebo na cloudu

\subsubsection{Trénování lokálnì}
%train the network
%`$OBJ_DET/train.py --logtostderr --train_dir=training/ --pipeline_config_path=training/ssd_mobilenet_v1_coco.config`
%
\subsubsection{Trénování na Google Cloud Platform}

\section{Ovìøení funkènosti a výsledky}
%export inference graph
%```
%python3.5 export_inference_graph.py \
%--input_type image_tensor \
%--pipeline_config_path training/ssd_mobilenet_v1_coco.config \
%--trained_checkpoint_prefix training/model.ckpt-7918 \
%--output_directory frozen_graph
%```

ipnb notebook

ukazka vysledku trenovani podle jednoho modelu a trenovani podle druheho modelu

\section{Závìr}

